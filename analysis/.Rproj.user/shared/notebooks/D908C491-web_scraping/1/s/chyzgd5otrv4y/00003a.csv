"0","findTerms <- function(term, codeAsText){"
"0","    present <- grepl(term, codeAsText)"
"0","    if(present == TRUE) {"
"0","      val <- term"
"0","    } else {"
"0","      val <- NA"
"0","    }"
"0","    return(val)"
"0","}"
"0","findHandbook <- function(school, state, url, .pb = NULL){"
"0","	if ((!is.null(.pb)) && inherits(.pb, ""Progress"") && (.pb$i < .pb$n)) .pb$tick()$print()"
"0","	Sys.sleep(0.001)"
"0","  "
"0","  http <- ifelse(grepl(""www|http"", url) == FALSE, paste0(""http://www."", url),"
"0","                 ifelse(grepl(""www"", url) == TRUE & grepl(""http"", url == FALSE), paste0(""http://"", url), url))"
"0","  "
"0","  possiblyRead <- possibly(GET, otherwise = NULL)"
"0","  html <- possiblyRead(http)"
"0","  "
"0","  if (!is.null(html)){"
"0","    ## Convert xml to text"
"0","    code <- content(html, as = ""text"", encoding = ""UTF-8"")"
"0","    "
"0","    searchTerms <- c(""form "", ""handbook"","" dress"", ""dress code"", ""appearance"", ""guide"", ""guidebook"", ""code of conduct"", ""manual"")"
"0","    "
"0","    data <- tibble("
"0","      schoolName = school,"
"0","      stateAbb = state,"
"0","      matches = map2_chr(searchTerms, code, findTerms)"
"0","    ) %>% "
"0","      filter(!is.na(matches))"
"0","    "
"0","    fileName <- here::here(""processed_data"", ""handbookMatches.csv"")"
"0","  "
"0","    write.table(data, file = fileName, append = TRUE, sep = "","", row.names = FALSE, col.names = !file.exists(fileName))"
"0","    "
"0","    return(data)"
"0","  } else {"
"0","    data <- tibble("
"0","      schoolName = school,"
"0","      stateAbb = state,"
"0","      matches = ""ERROR"""
"0","    )"
"0","    "
"0","    fileName <- here::here(""processed_data"", ""handbookMatches.csv"")"
"0","  "
"0","    write.table(data, file = fileName, append = TRUE, sep = "","", row.names = FALSE, col.names = !file.exists(fileName))"
"0","    "
"0","    return(data)"
"0","  }"
"0","  "
"0","}"
